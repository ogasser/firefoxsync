(function(e){if(typeof module!=="undefined"&&module&&module.exports){module.exports=e()}else if(typeof define==="function"&&define.amd){define(e)}else{P=e()}})(function(){"use strict";var e=p(typeof process)&&{}.toString.call(process)==="[object process]",t=p(typeof setImmediate),n={f:null,n:null},r=n,i=false,o=e&&_||y(h)||w(h),u=[],f=w(d),a,c,s,l=p.call,v=p.apply;function p(e){return e==="object"||e==="function"}function d(){if(u.length){throw u.shift()}}function h(){while(n.n){n=n.n;var e=n.f;n.f=null;e.call()}i=false}var m=function(e){r=r.n={f:e,n:null};if(!i){i=true;o()}};function _(){var e=process.domain;if(e){if(!s)s=(1,require)("domain");s.active=process.domain=null}if(i&&t){setImmediate(h)}else{process.nextTick(h)}if(e){s.active=process.domain=e}}function y(e){var t=p(typeof MutationObserver)?new MutationObserver(e):p(typeof WebKitMutationObserver)?new WebKitMutationObserver(e):null;if(!t){return null}var n=1;var r=document.createTextNode("");t.observe(r,{characterData:true});return function(){n=-n;r.data=n}}function w(e){return function(){var t=setTimeout(r,0);var n=setInterval(r,50);function r(){clearTimeout(t);clearInterval(n);e()}}}if(e){a=function(e){var t=process.domain;return function(){if(t){if(t._disposed)return;t.enter()}try{e.call()}catch(n){o();throw n}if(t){t.exit()}}};c=function(e){var t=process.domain;m(!t?e:function(){if(!t._disposed){t.enter();e.call();t.exit()}})}}else{a=function(e){return function(){try{e.call()}catch(t){u.push(t);f()}}};c=m}function g(e){m(a(e))}function T(e,t){for(var n=0,r=e.length;n<r;++n){if(n in e){t(e[n],n)}}}function b(e){g(function(){if(I.onerror){I.onerror.call(null,e)}else{throw e}})}var j=0;var x=1;var O=2;function I(e){return e instanceof D?e:K(new D,e)}function M(t,n,r,i){if(t._state){return t}t._state=n;t._value=r;if(i){t._domain=i}else if(e&&n===O){t._domain=process.domain}if(t._pending.length){T(t._pending,m)}t._pending=null;return t}function E(e,t){e._pending.push(t)}function k(e,t){M(t,e._state,e._value,e._domain)}function K(e,t){if(e._state){return e}if(t instanceof D){if(t===e){M(e,O,new TypeError("You can't resolve a promise with itself"))}else if(t._state){k(t,e)}else{E(t,function(){k(t,e)})}}else if(t!==Object(t)){M(e,x,t)}else{c(function(){var n=S(e);try{var r=t.then;if(typeof r==="function"){l.call(r,t,n.resolve,n.reject)}else{M(e,x,t)}}catch(i){n.reject(i)}})}return e}function S(e){var t=false;return{promise:e,resolve:function(n){if(!t){t=true;K(e,n)}},reject:function(n){if(!t){t=true;M(e,O,n)}}}}I.defer=W;function W(){return S(new D)}I.reject=q;function q(e){return M(new D,O,e)}function D(){this._state=0;this._value=void 0;this._domain=null;this._pending=[]}D.prototype.then=function(t,n){var r=typeof t==="function"?t:null;var i=typeof n==="function"?n:null;var o=this;var u=new D;var f=e&&process.domain;function a(){var e=o._state===x?r:i;if(!e){k(o,u);return}var t,n=false;var a=o._domain||f;if(a){if(a._disposed)return;a.enter()}try{t=e(o._value)}catch(c){n=true;M(u,O,c)}if(!n){K(u,t)}if(a){a.exit()}}if(o._state===j){E(o,a)}else{m(a)}return u};D.prototype.done=function(e,t){var n=this;if(e||t){n=n.then(e,t)}n.then(null,b)};D.prototype.fail=function(e){return this.then(null,e)};D.prototype.spread=function(e,t){return this.then(e&&function(n){return Y(n,[]).then(function(t){return v.call(e,void 0,t)},t)},t)};D.prototype.timeout=function(e,t){var n=this;var r=new D;if(n._state!==j){k(n,r)}else{var i=setTimeout(function(){M(r,O,new Error(t||"Timed out after "+e+" ms"))},e);E(n,function(){clearTimeout(i);k(n,r)})}return r};D.prototype.delay=function(e){var t=W();this.then(function(n){setTimeout(function(){t.resolve(n)},e)},t.reject);return t.promise};D.prototype.inspect=function(){switch(this._state){case j:return{state:"pending"};case x:return{state:"fulfilled",value:this._value};case O:return{state:"rejected",reason:this._value};default:throw new TypeError("invalid state")}};function N(e){function t(t){return e(t,[])}function n(e){return I(e).then(t)}n._=e;return n}I.allSettled=N(P);function P(e,t){var n=0;var r=new D;T(e,function(e,i){var o=I(e);if(o._state===j){++n;E(o,function(){t[i]=o.inspect();if(--n===0){M(r,x,t)}})}else{t[i]=o.inspect()}});if(n===0){M(r,x,t)}return r}I.all=N(Y);function Y(e,t){var n=0;var r=W();T(e,function(e,i){var o=I(e);if(o._state===x){t[i]=o._value}else{++n;o.then(function(e){t[i]=e;if(--n===0){r.resolve(t)}},r.reject)}});if(n===0){r.resolve(t)}return r.promise}I.promised=z;function z(e){function t(t){return v.apply(e,t)}return function(){var e=Y(arguments,[]);return Y([this,e],[]).then(t)}}I.onerror=null;I.nextTick=g;return I});